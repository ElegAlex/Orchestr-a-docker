# Phase 6C - Tests d'Int√©gration End-to-End

**Date**: 13 octobre 2025
**Statut**: üß™ EN COURS

## Vue d'ensemble

Plan de tests complet pour valider la migration Firebase ‚Üí NestJS backend pour les services Users, Projects et Tasks.

## Pr√©requis

### 1. Backend en Cours d'Ex√©cution

```bash
# Depuis /backend
npm run start:dev

# V√©rifier que le backend r√©pond
curl http://localhost:3000/health
# Attendu: {"status":"ok","timestamp":"..."}
```

### 2. Base de Donn√©es PostgreSQL

```bash
# V√©rifier que PostgreSQL est accessible
cd backend
npx prisma db pull

# V√©rifier les donn√©es migr√©es
psql -d orchestr_a -c "SELECT COUNT(*) FROM \"User\";"
psql -d orchestr_a -c "SELECT COUNT(*) FROM \"Project\";"
psql -d orchestr_a -c "SELECT COUNT(*) FROM \"Task\";"
```

### 3. Frontend Compil√©

```bash
# Depuis /orchestra-app
npm run build

# V√©rifier qu'il n'y a pas d'erreurs TypeScript
npx tsc --noEmit
```

### 4. Token JWT Valide

Pour tester les API calls, vous aurez besoin d'un token JWT. R√©cup√©rez-le depuis :
1. Login via le frontend
2. Ouvrir DevTools ‚Üí Application ‚Üí Local Storage
3. Copier la valeur de la cl√© `token`

Ou utilisez le endpoint login :
```bash
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"votre_password"}'
```

## Tests Backend (API REST)

### Module Auth

#### 1. Login Email/Password
```bash
TOKEN=$(curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"Admin123!"}' \
  -s | jq -r '.access_token')

echo "Token: $TOKEN"
```

**R√©sultat attendu** :
- Status 200
- Retourne un token JWT
- Token non vide

#### 2. R√©cup√©rer le Profil
```bash
curl http://localhost:3000/auth/profile \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- Retourne les infos de l'utilisateur connect√©
- `id`, `email`, `firstName`, `lastName`, `role`

### Module Users

#### 1. Lister Tous les Utilisateurs
```bash
curl http://localhost:3000/users \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq '.data | length'
```

**R√©sultat attendu** :
- Status 200
- Retourne un tableau d'utilisateurs
- `data` contient au moins 1 utilisateur

#### 2. R√©cup√©rer un Utilisateur par ID
```bash
# Remplacer USER_ID par un ID valide
USER_ID="votre_user_id"
curl http://localhost:3000/users/$USER_ID \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- Retourne l'utilisateur avec l'ID sp√©cifi√©
- Champs : `id`, `email`, `firstName`, `lastName`, `role`, `departmentId`

#### 3. Cr√©er un Nouvel Utilisateur
```bash
curl -X POST http://localhost:3000/users \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test-integration@example.com",
    "password": "Test123!",
    "firstName": "Test",
    "lastName": "Integration",
    "role": "employee"
  }' \
  -s | jq
```

**R√©sultat attendu** :
- Status 201
- Retourne l'utilisateur cr√©√© avec un `id`
- `email` = "test-integration@example.com"

#### 4. Mettre √† Jour un Utilisateur
```bash
# Utiliser l'ID de l'utilisateur cr√©√© ci-dessus
NEW_USER_ID="id_du_user_cr√©√©"

curl -X PATCH http://localhost:3000/users/$NEW_USER_ID \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "firstName": "TestModifi√©"
  }' \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- `firstName` = "TestModifi√©"

#### 5. Supprimer un Utilisateur
```bash
curl -X DELETE http://localhost:3000/users/$NEW_USER_ID \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- L'utilisateur est supprim√© (soft delete: `isActive` = false)

### Module Projects

#### 1. Lister Tous les Projets
```bash
curl http://localhost:3000/projects \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq '.data | length'
```

**R√©sultat attendu** :
- Status 200
- Retourne un tableau de projets
- `data` contient au moins 1 projet

#### 2. R√©cup√©rer un Projet par ID
```bash
PROJECT_ID="votre_project_id"
curl http://localhost:3000/projects/$PROJECT_ID \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- Retourne le projet avec l'ID sp√©cifi√©
- Champs : `id`, `name`, `description`, `managerId`, `status`, `priority`

#### 3. Cr√©er un Nouveau Projet
```bash
curl -X POST http://localhost:3000/projects \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Projet Test Integration",
    "description": "Projet de test end-to-end",
    "managerId": "'$USER_ID'",
    "status": "ACTIVE",
    "priority": "HIGH",
    "startDate": "2025-10-13T00:00:00.000Z",
    "dueDate": "2025-12-31T00:00:00.000Z",
    "budget": 50000,
    "tags": ["test", "integration"]
  }' \
  -s | jq
```

**R√©sultat attendu** :
- Status 201
- Retourne le projet cr√©√© avec un `id`
- `name` = "Projet Test Integration"

#### 4. Mettre √† Jour un Projet
```bash
NEW_PROJECT_ID="id_du_projet_cr√©√©"

curl -X PATCH http://localhost:3000/projects/$NEW_PROJECT_ID \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "IN_PROGRESS",
    "priority": "MEDIUM"
  }' \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- `status` = "IN_PROGRESS"
- `priority` = "MEDIUM"

#### 5. Ajouter un Membre √† l'√âquipe
```bash
MEMBER_USER_ID="un_autre_user_id"

curl -X POST http://localhost:3000/projects/$NEW_PROJECT_ID/members \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "'$MEMBER_USER_ID'",
    "role": "member"
  }' \
  -s | jq
```

**R√©sultat attendu** :
- Status 201
- Le membre est ajout√© au projet

#### 6. R√©cup√©rer les Statistiques d'un Projet
```bash
curl http://localhost:3000/projects/$NEW_PROJECT_ID/stats \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- Retourne des stats : `totalTasks`, `completedTasks`, `progress`, etc.

#### 7. Supprimer un Projet
```bash
curl -X DELETE http://localhost:3000/projects/$NEW_PROJECT_ID \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- Le projet est supprim√©

### Module Tasks

#### 1. Lister Toutes les T√¢ches
```bash
curl http://localhost:3000/tasks \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq '.data | length'
```

**R√©sultat attendu** :
- Status 200
- Retourne un tableau de t√¢ches
- `data` contient au moins 1 t√¢che

#### 2. R√©cup√©rer une T√¢che par ID
```bash
TASK_ID="votre_task_id"
curl http://localhost:3000/tasks/$TASK_ID \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- Retourne la t√¢che avec l'ID sp√©cifi√©
- Champs : `id`, `title`, `description`, `projectId`, `assigneeId`, `status`

#### 3. Cr√©er une Nouvelle T√¢che
```bash
curl -X POST http://localhost:3000/tasks \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "T√¢che Test Integration",
    "description": "T√¢che de test end-to-end",
    "projectId": "'$PROJECT_ID'",
    "assigneeId": "'$USER_ID'",
    "status": "TODO",
    "priority": "HIGH",
    "dueDate": "2025-10-20T00:00:00.000Z",
    "estimatedHours": 8,
    "tags": ["test"]
  }' \
  -s | jq
```

**R√©sultat attendu** :
- Status 201
- Retourne la t√¢che cr√©√©e avec un `id`
- `title` = "T√¢che Test Integration"

#### 4. Mettre √† Jour une T√¢che
```bash
NEW_TASK_ID="id_de_la_t√¢che_cr√©√©e"

curl -X PATCH http://localhost:3000/tasks/$NEW_TASK_ID \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "IN_PROGRESS",
    "priority": "MEDIUM"
  }' \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- `status` = "IN_PROGRESS"
- `priority` = "MEDIUM"

#### 5. Changer le Statut d'une T√¢che
```bash
curl -X PATCH http://localhost:3000/tasks/$NEW_TASK_ID/status \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "DONE"
  }' \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- `status` = "DONE"
- `completedAt` est d√©fini

#### 6. Assigner une T√¢che
```bash
curl -X PATCH http://localhost:3000/tasks/$NEW_TASK_ID/assign \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "assigneeId": "'$MEMBER_USER_ID'"
  }' \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- `assigneeId` = ID du nouveau assignee

#### 7. R√©cup√©rer les T√¢ches d'un Projet
```bash
curl http://localhost:3000/tasks/project/$PROJECT_ID \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- Retourne toutes les t√¢ches du projet

#### 8. Supprimer une T√¢che
```bash
curl -X DELETE http://localhost:3000/tasks/$NEW_TASK_ID \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq
```

**R√©sultat attendu** :
- Status 200
- La t√¢che est supprim√©e

## Tests Frontend (Services + UI)

### D√©marrage Frontend

```bash
cd orchestra-app
npm start
```

Ouvrir http://localhost:3000

### 1. Test Authentification

#### Login
1. Ouvrir la page de login
2. Entrer email + password
3. Cliquer "Se connecter"

**R√©sultat attendu** :
- ‚úÖ Redirection vers le dashboard
- ‚úÖ Token JWT stock√© dans localStorage
- ‚úÖ Nom de l'utilisateur affich√© dans la navbar
- ‚úÖ Pas d'erreur console

#### Profil Utilisateur
1. Cliquer sur l'ic√¥ne utilisateur
2. Cliquer "Profil"
3. V√©rifier les informations affich√©es

**R√©sultat attendu** :
- ‚úÖ Email, nom, pr√©nom affich√©s correctement
- ‚úÖ R√¥le affich√©
- ‚úÖ Avatar ou initiales

### 2. Test Module Users

#### Lister les Utilisateurs
1. Aller dans "Administration" ‚Üí "Utilisateurs"
2. V√©rifier que la liste s'affiche

**R√©sultat attendu** :
- ‚úÖ Liste des utilisateurs charg√©e
- ‚úÖ Pas d'erreur console
- ‚úÖ Champs affich√©s : nom, email, r√¥le, d√©partement

#### Cr√©er un Utilisateur
1. Cliquer "Nouvel utilisateur"
2. Remplir le formulaire :
   - Email: `test-ui@example.com`
   - Pr√©nom: `TestUI`
   - Nom: `Integration`
   - R√¥le: `employee`
3. Cliquer "Cr√©er"

**R√©sultat attendu** :
- ‚úÖ Utilisateur cr√©√© avec succ√®s
- ‚úÖ Toast de confirmation
- ‚úÖ Utilisateur appara√Æt dans la liste
- ‚úÖ Pas d'erreur console

#### Modifier un Utilisateur
1. Cliquer sur un utilisateur dans la liste
2. Cliquer "Modifier"
3. Changer le pr√©nom
4. Cliquer "Enregistrer"

**R√©sultat attendu** :
- ‚úÖ Utilisateur mis √† jour
- ‚úÖ Toast de confirmation
- ‚úÖ Changement visible dans la liste
- ‚úÖ Pas d'erreur console

#### D√©sactiver un Utilisateur
1. Cliquer sur un utilisateur
2. Cliquer "D√©sactiver"
3. Confirmer

**R√©sultat attendu** :
- ‚úÖ Utilisateur d√©sactiv√© (`isActive` = false)
- ‚úÖ Toast de confirmation
- ‚úÖ Badge "Inactif" affich√©
- ‚úÖ Pas d'erreur console

### 3. Test Module Projects

#### Lister les Projets
1. Aller dans "Projets"
2. V√©rifier que la liste s'affiche

**R√©sultat attendu** :
- ‚úÖ Liste des projets charg√©e
- ‚úÖ Pas d'erreur console
- ‚úÖ Champs affich√©s : nom, statut, priorit√©, progression

#### Cr√©er un Projet
1. Cliquer "Nouveau projet"
2. Remplir le formulaire :
   - Nom: `Projet Test UI`
   - Description: `Test d'int√©gration frontend`
   - Manager: S√©lectionner un utilisateur
   - Statut: `ACTIVE`
   - Priorit√©: `HIGH`
   - Date d√©but: Aujourd'hui
   - Date fin: +1 mois
   - Budget: `50000`
3. Cliquer "Cr√©er"

**R√©sultat attendu** :
- ‚úÖ Projet cr√©√© avec succ√®s
- ‚úÖ Toast de confirmation
- ‚úÖ Projet appara√Æt dans la liste
- ‚úÖ Pas d'erreur console

#### Modifier un Projet
1. Cliquer sur un projet dans la liste
2. Cliquer "Modifier"
3. Changer la priorit√© √† `MEDIUM`
4. Cliquer "Enregistrer"

**R√©sultat attendu** :
- ‚úÖ Projet mis √† jour
- ‚úÖ Toast de confirmation
- ‚úÖ Changement visible dans la liste
- ‚úÖ Pas d'erreur console

#### Ajouter un Membre √† l'√âquipe
1. Ouvrir un projet
2. Aller dans l'onglet "√âquipe"
3. Cliquer "Ajouter membre"
4. S√©lectionner un utilisateur
5. Choisir le r√¥le `member`
6. Cliquer "Ajouter"

**R√©sultat attendu** :
- ‚úÖ Membre ajout√© avec succ√®s
- ‚úÖ Toast de confirmation
- ‚úÖ Membre appara√Æt dans la liste de l'√©quipe
- ‚úÖ Pas d'erreur console

#### Voir les Statistiques d'un Projet
1. Ouvrir un projet
2. V√©rifier les stats affich√©es

**R√©sultat attendu** :
- ‚úÖ Nombre de t√¢ches affich√©
- ‚úÖ T√¢ches compl√©t√©es affich√©es
- ‚úÖ Progression affich√©e (%)
- ‚úÖ Pas d'erreur console

### 4. Test Module Tasks

#### Lister les T√¢ches d'un Projet
1. Ouvrir un projet
2. Aller dans l'onglet "T√¢ches"
3. V√©rifier que la liste s'affiche

**R√©sultat attendu** :
- ‚úÖ Liste des t√¢ches charg√©e
- ‚úÖ Pas d'erreur console
- ‚úÖ Champs affich√©s : titre, assign√©, statut, priorit√©

#### Cr√©er une T√¢che
1. Cliquer "Nouvelle t√¢che"
2. Remplir le formulaire :
   - Titre: `T√¢che Test UI`
   - Description: `Test d'int√©gration frontend`
   - Assign√©: S√©lectionner un utilisateur
   - Statut: `TODO`
   - Priorit√©: `HIGH`
   - Date limite: +1 semaine
   - Estimation: `8` heures
3. Cliquer "Cr√©er"

**R√©sultat attendu** :
- ‚úÖ T√¢che cr√©√©e avec succ√®s
- ‚úÖ Toast de confirmation
- ‚úÖ T√¢che appara√Æt dans la liste
- ‚úÖ Pas d'erreur console

#### Modifier une T√¢che
1. Cliquer sur une t√¢che dans la liste
2. Cliquer "Modifier"
3. Changer le statut √† `IN_PROGRESS`
4. Cliquer "Enregistrer"

**R√©sultat attendu** :
- ‚úÖ T√¢che mise √† jour
- ‚úÖ Toast de confirmation
- ‚úÖ Changement visible dans la liste
- ‚úÖ Pas d'erreur console

#### Kanban Board
1. Aller dans un projet
2. Afficher le Kanban
3. V√©rifier que les colonnes sont affich√©es

**R√©sultat attendu** :
- ‚úÖ Colonnes : TODO, IN_PROGRESS, REVIEW, DONE, BLOCKED
- ‚úÖ T√¢ches dans les bonnes colonnes
- ‚úÖ Drag & drop fonctionne (d√©placer une t√¢che)
- ‚úÖ Pas d'erreur console

#### Assigner une T√¢che
1. Cliquer sur une t√¢che
2. Cliquer "Assigner"
3. S√©lectionner un utilisateur
4. Cliquer "Enregistrer"

**R√©sultat attendu** :
- ‚úÖ T√¢che assign√©e avec succ√®s
- ‚úÖ Toast de confirmation
- ‚úÖ Nom de l'assign√© affich√©
- ‚úÖ Pas d'erreur console

#### Changer le Statut d'une T√¢che
1. Cliquer sur une t√¢che
2. Changer le statut via le dropdown
3. Confirmer

**R√©sultat attendu** :
- ‚úÖ Statut mis √† jour
- ‚úÖ Toast de confirmation
- ‚úÖ T√¢che d√©plac√©e dans la bonne colonne (Kanban)
- ‚úÖ Pas d'erreur console

#### Supprimer une T√¢che
1. Cliquer sur une t√¢che
2. Cliquer "Supprimer"
3. Confirmer la suppression

**R√©sultat attendu** :
- ‚úÖ T√¢che supprim√©e
- ‚úÖ Toast de confirmation
- ‚úÖ T√¢che dispara√Æt de la liste
- ‚úÖ Pas d'erreur console

## Tests de Performance

### 1. Temps de Chargement

#### Page Utilisateurs
```bash
# Mesurer avec curl
time curl http://localhost:3000/users \
  -H "Authorization: Bearer $TOKEN" \
  -s > /dev/null
```

**R√©sultat attendu** :
- < 500ms pour 100 utilisateurs
- < 1s pour 1000 utilisateurs

#### Page Projets
```bash
time curl http://localhost:3000/projects \
  -H "Authorization: Bearer $TOKEN" \
  -s > /dev/null
```

**R√©sultat attendu** :
- < 500ms pour 50 projets
- < 1s pour 500 projets

#### Page T√¢ches
```bash
time curl http://localhost:3000/tasks \
  -H "Authorization: Bearer $TOKEN" \
  -s > /dev/null
```

**R√©sultat attendu** :
- < 500ms pour 200 t√¢ches
- < 1s pour 2000 t√¢ches

### 2. Tests de Charge

Utiliser Apache Bench ou Artillery pour tester :

```bash
# Installer Artillery
npm install -g artillery

# Test de charge
artillery quick --count 10 --num 100 http://localhost:3000/users
```

**R√©sultat attendu** :
- > 95% de requ√™tes r√©ussies
- Temps de r√©ponse m√©dian < 200ms
- Pas de crash du serveur

## Tests d'Erreurs

### 1. Authentification Invalide

```bash
curl http://localhost:3000/users \
  -H "Authorization: Bearer invalid_token" \
  -s | jq
```

**R√©sultat attendu** :
- Status 401 Unauthorized
- Message d'erreur clair

### 2. Donn√©es Invalides

```bash
curl -X POST http://localhost:3000/users \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "invalid-email",
    "password": "123"
  }' \
  -s | jq
```

**R√©sultat attendu** :
- Status 400 Bad Request
- Erreurs de validation d√©taill√©es

### 3. Ressource Non Trouv√©e

```bash
curl http://localhost:3000/users/00000000-0000-0000-0000-000000000000 \
  -H "Authorization: Bearer $TOKEN" \
  -s | jq
```

**R√©sultat attendu** :
- Status 404 Not Found
- Message d'erreur clair

## Checklist de Validation

### Backend API
- [ ] Auth login fonctionne
- [ ] Auth profile fonctionne
- [ ] Users CRUD complet
- [ ] Projects CRUD complet
- [ ] Tasks CRUD complet
- [ ] Gestion des membres d'√©quipe
- [ ] Statistiques des projets
- [ ] Filtres et recherche
- [ ] Pagination
- [ ] Gestion des erreurs

### Frontend Services
- [ ] user.service.ts sans Firebase
- [ ] project.service.ts sans Firebase
- [ ] task.service.ts sans Firebase
- [ ] Auth avec JWT tokens
- [ ] Pas d'erreurs console
- [ ] Pas de warnings TypeScript

### Frontend UI
- [ ] Login/Logout
- [ ] Liste utilisateurs
- [ ] CRUD utilisateurs
- [ ] Liste projets
- [ ] CRUD projets
- [ ] Liste t√¢ches
- [ ] CRUD t√¢ches
- [ ] Kanban board
- [ ] Gestion √©quipe projet
- [ ] Statistiques projet
- [ ] Toast notifications
- [ ] Loading states
- [ ] Error handling

### Performance
- [ ] < 500ms chargement listes
- [ ] < 200ms op√©rations CRUD
- [ ] Pas de memory leaks
- [ ] Scroll fluide

### S√©curit√©
- [ ] JWT tokens requis
- [ ] Tokens expir√©s rejet√©s
- [ ] Validation des inputs
- [ ] CORS configur√©
- [ ] Rate limiting

## Rapport de Tests

√Ä remplir apr√®s ex√©cution des tests :

```markdown
## R√©sultats Tests - [Date]

### Backend API
- ‚úÖ Auth: XX/XX tests pass√©s
- ‚úÖ Users: XX/XX tests pass√©s
- ‚úÖ Projects: XX/XX tests pass√©s
- ‚úÖ Tasks: XX/XX tests pass√©s

### Frontend Services
- ‚úÖ user.service.ts: Fonctionnel
- ‚úÖ project.service.ts: Fonctionnel
- ‚úÖ task.service.ts: Fonctionnel

### Frontend UI
- ‚úÖ XX/XX fonctionnalit√©s test√©es

### Performance
- Temps moyen API: XXXms
- Temps chargement page: XXXms

### Bugs Trouv√©s
1. [Description bug]
2. [Description bug]

### Actions Requises
- [ ] Fixer bug #1
- [ ] Optimiser performance endpoint X
```

## Conclusion

Une fois tous les tests pass√©s avec succ√®s :
- ‚úÖ Phase 6C termin√©e
- ‚û°Ô∏è Passer √† Phase 6D - Documentation finale

---

**Auteur**: Claude Code
**Date**: 13 octobre 2025
